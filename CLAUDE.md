# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What This Is

A personal Emacs configuration (~/.emacs.d) optimized for Dvorak keyboard layout, variable-width fonts, and multi-lingual text. All custom code uses the `ublt/` namespace prefix (and `ublt-` for filenames/features).

## Repository Structure

- `init.el` - Entry point. Loads config modules in a specific order. Do not reorder without understanding dependencies.
- `config/ublt-*.el` - Feature modules, each providing a `ublt-<name>` feature
- `lib/ublt-straight-recipes.el` - Custom straight.el package recipes (local dev overrides for tree-sitter packages)
- `custom.el` - Auto-generated by Emacs customize system; loaded via `after-init-hook`
- `straight/versions/default.el` - Pinned package versions (commit hashes)

## Key Architectural Patterns

### Module Loading Order (init.el)
1. Early config (paths, TLS, compatibility shims for Emacs 28+/30+)
2. Package manager bootstrap (`straight.el` by default, `package.el` via `EMACS_PACKAGE_MANAGER` env var)
3. `dash` + `ublt-util` (foundational utilities, must load before everything else)
4. General usability: `ublt-misc`, `ublt-dvorak`, `ublt-appearance`, `ublt-navigation`, `ublt-editing`
5. Tools: `ublt-evil`, `ublt-dired`, `ublt-helm`, `ublt-git`, `ublt-flycheck`
6. Language modules: `ublt-programming` (generic), then language-specific modules

### Custom Macros (ublt-util.el)
- `ublt/set-up FEATURE &body` - Safely load optional feature; body runs only on success. Prevents one feature's failure from breaking others.
- `ublt/in SYSTEMS &body` - Run body only on listed `system-type` values (e.g., `'(gnu/linux darwin)`)
- `ublt/with-demand &body` / `ublt/with-defer &body` - Force `use-package` to load immediately or defer
- `ublt/off MINOR-MODE` - Returns a lambda that disables a minor mode (for hooks)

### Package Management
Uses `straight.el` with `use-package` (`straight-use-package-by-default t`). Packages that are built-in to Emacs use `:straight nil` in their `use-package` declarations. Custom recipes in `lib/ublt-straight-recipes.el` override certain packages to use local development copies (notably tree-sitter packages pointing to `~/Programming/projects/`).

### All Files Use
```elisp
;;; -*- lexical-binding: t; coding: utf-8 -*-
```

## Important Conventions

- **Naming**: All custom functions/variables: `ublt/name`. All features/files: `ublt-name`. Internal helpers: `ublt/-name` (with extra hyphen).
- **Advice naming**: Uses `define-advice` with named advices (`:around`, `:before`, `:after` with `ublt/advice-name` pattern).
- **Platform code**: OS-specific code is wrapped in `ublt/in` or `pcase system-type`. Font config is split into `ublt-font.el` (generic), `ublt-font-osx.el`, `ublt-font-linux.el`.
- **Theme**: `ublt-dark-theme.el` is a large custom theme (~1,200 lines). Color choices are documented with CIELAB color space reasoning in comments.
- **Dvorak**: `ublt-dvorak.el` (~1,200 lines) remaps most navigation and editing keys for Dvorak layout. This is the largest module and affects keybindings globally.

## Working with This Config

There is no build system, test suite, or linter. The code is evaluated by Emacs at startup or interactively.

- To test changes: evaluate individual forms with `eval-last-sexp` (C-x C-e) or `eval-buffer`, or restart Emacs.
- Package versions are pinned in `straight/versions/default.el`. To update: `M-x straight-freeze-versions`.
- The `ublt/timing-threshold-for-command` and related timing infrastructure in `ublt-util.el` can help diagnose performance issues.
